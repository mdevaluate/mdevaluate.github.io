

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Loading of simulation data &mdash; mdevaluate 17.08 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/gallery.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="mdevaluate 17.08 documentation" href="index.html"/>
        <link rel="up" title="User Guide" href="guide.html"/>
        <link rel="next" title="Evaluation of static properties" href="static-evaluation.html"/>
        <link rel="prev" title="User Guide" href="guide.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> mdevaluate
          

          
          </a>

          
            
            
              <div class="version">
                17.08
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="general-hints.html">General Hints for Python Programming</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="guide.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Loading of simulation data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selecting-a-subset">Selecting a subset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#specifying-data-files">Specifying data files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#caching-of-frames">Caching of frames</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#freeing-cached-frames">Freeing cached frames</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-deprecated-way-of-loading-simulations">The deprecated way of loading simulations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#atoms">Atoms</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trajectory">Trajectory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#coordinates">Coordinates</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="static-evaluation.html">Evaluation of static properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamic-evaluation.html">Evaluation of dynamic properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="special-topics.html">Special Topics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="gallery/index.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribution.html">Contribution Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Reference Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mdevaluate</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="guide.html">User Guide</a> &raquo;</li>
        
      <li>Loading of simulation data</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/loading.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="loading-of-simulation-data">
<h1>Loading of simulation data<a class="headerlink" href="#loading-of-simulation-data" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The process of loading simulations has been simplified in the latest version of mdevaluate.
The previous way is described below for completeness and people with an older code base.</p>
</div>
<p>Mdevaulate provides a convenient function <a class="reference internal" href="mdevaluate.html#mdevaluate.load_simulation" title="mdevaluate.load_simulation"><code class="xref py py-func docutils literal"><span class="pre">mdevaluate.load_simulation()</span></code></a>
that loads a simulation more or less automatically.
It takes a path as input and looks for all files it needs in this directory.</p>
<p>For information about the topology either a <cite>tpr</cite> or <cite>gro</cite> a file is read,
where the former is the preferred choice.
Trajectory data will be read from a xtc file.
If the directory contains more than one file of any type, the desired file
has to be specified with the appropriate keyword argument.
For details see <a class="reference internal" href="mdevaluate.html#mdevaluate.load_simulation" title="mdevaluate.load_simulation"><code class="xref py py-func docutils literal"><span class="pre">mdevaluate.load_simulation()</span></code></a>.</p>
<p>The function will return a coordinates object, for the whole system.
A subset of the system may be obtained directly from the coordinates object by
calling its <a class="reference internal" href="mdevaluate.html#mdevaluate.coordinates.Coordinates.subset" title="mdevaluate.coordinates.Coordinates.subset"><code class="xref py py-func docutils literal"><span class="pre">subset()</span></code></a> method.
This function accepts the same input as <a class="reference internal" href="mdevaluate.html#mdevaluate.atoms.AtomSubset.subset" title="mdevaluate.atoms.AtomSubset.subset"><code class="xref py py-func docutils literal"><span class="pre">mdevaluate.atoms.AtomSubset.subset()</span></code></a>.
A new feature that was introduced in the function is the possibility to chose
atoms with regular expressions.</p>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>The following code loads the example trajectory and selects a subset of all CW atoms.
Since there are two CW atoms in each molecule (CW1 and CW2) a regular expression is
used when selecting the subset.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mdevaluate</span> <span class="k">as</span> <span class="nn">md</span>

<span class="n">trajectory</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/data/niels/tutorial&#39;</span><span class="p">)</span>
<span class="n">CW_atoms</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">atom_name</span><span class="o">=</span><span class="s1">&#39;CW.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And that’s it, now one can evaluate stuff for this subset of atoms.</p>
</div>
<div class="section" id="selecting-a-subset">
<h2>Selecting a subset<a class="headerlink" href="#selecting-a-subset" title="Permalink to this headline">¶</a></h2>
<p>As shown in the example above it is often necessary to select a subset of the system for analysis.
This can be a special group of atoms (e.g. all C atoms) or a whole residue for which the center of mass should be computed.
Subsets are selected with the <code class="xref py py-func docutils literal"><span class="pre">subset()</span></code> method of Coordinates objects.</p>
<p>This method accepts four keyword arguments, with which the atom name, residue name and residue id or atom indices can be specified.
The former two name arguments accept a regular expression which allows two include several different names in one subset.
Some examples:</p>
<ul class="simple">
<li>All carbon atoms (which are named CW1, CT1, CA, …): <code class="docutils literal"><span class="pre">tr.subset(atom_name='C.*')</span></code></li>
<li>Atoms NA1, NA2 and OW: <code class="docutils literal"><span class="pre">tr.subset(atom_name='NA.|OW')</span></code></li>
<li>All oxygen atoms of residue EG: <code class="docutils literal"><span class="pre">tr.subset(atom_name='O.*',</span> <span class="pre">residue_name='EG')</span></code></li>
</ul>
</div>
<div class="section" id="specifying-data-files">
<h2>Specifying data files<a class="headerlink" href="#specifying-data-files" title="Permalink to this headline">¶</a></h2>
<p>The above example only works if the directory contains exactly one tpr file and
one xtc file.
If your data files are located in subdirectories or multiple files of these types exist,
they can be specified by the keywords <code class="docutils literal"><span class="pre">topology</span></code> and <code class="docutils literal"><span class="pre">trajectory</span></code>.
Those filenames can be a relative path to the simulation directory and can also make
use of <em>shell globing</em>. For example:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">traj</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/path/to/sim&#39;</span><span class="p">,</span> <span class="n">topology</span><span class="o">=</span><span class="s1">&#39;atoms.gro&#39;</span><span class="p">,</span> <span class="n">trajectory</span><span class="o">=</span><span class="s1">&#39;out/traj_*.xtc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the topology can be specified as a gro file, with the limitation that
only atom and residue names will be read from those files.
Information about atom masses and charges for example will only be read from tpr files,
therefore it is generally recommended to use the latter topologies.</p>
<p>The trajectory above is specified through a shell globing, meaning the <code class="docutils literal"><span class="pre">*</span></code> may be
expanded to any string (without containing a forward slash).
If more than one file exists which match this pattern an error will be raised,
since the trajectory can not be identified clearly.</p>
</div>
<div class="section" id="caching-of-frames">
<h2>Caching of frames<a class="headerlink" href="#caching-of-frames" title="Permalink to this headline">¶</a></h2>
<p>One bottleneck in the analysis of MD data is the reading speed of the trajectory.
In many cases frames will be needed repeatedly and hence the amount of time spend reading
data from disk (or worse over the network) is huge.
Therefore the mdevaluate package implements a simple caching mechanism, which holds
on to a number of read frames.
The downside if this is increased memory usage which may slow down the computation too.</p>
<p>Caching is done on the level of the trajectory readers, so that all <code class="docutils literal"><span class="pre">Coordinate</span></code> and
<code class="docutils literal"><span class="pre">CoordinateMap</span></code> objects working on the same trajectory will be sharing a cache.
Caching has to be activated when opening a trajectory:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">traj</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;/path/to/sim&#39;</span><span class="p">,</span> <span class="n">cached</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">cached</span></code> keyword takes either a boolean, a integer or None as input value.
The value of <code class="docutils literal"><span class="pre">cached</span></code> controls the size of the cache and thereby the additional memory usage.
Setting it to True will activate the caching with a maximum size of 128 frames,
with an integer any other maximum size may be set.
The special value <code class="docutils literal"><span class="pre">None</span></code> will set the cache size to infinite, so all frames will be cached.
This will prevent the frames from being loaded twice but can also consume a whole lot of memory,
since a single frame can easily take 1 MB of memory.</p>
<div class="section" id="freeing-cached-frames">
<h3>Freeing cached frames<a class="headerlink" href="#freeing-cached-frames" title="Permalink to this headline">¶</a></h3>
<p>In some scenarios it may be advisable to free cached frames which are no longer needed.
For this case the reader has a function <code class="docutils literal"><span class="pre">clear_cache()</span></code>.
The current state of the cache can be displayed with the <code class="docutils literal"><span class="pre">cache_info</span></code> property:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">cache_info</span>
<span class="go">CacheInfo(hits=12, misses=20, maxsize=128, currsize=20)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">traj</span><span class="o">.</span><span class="n">frames</span><span class="o">.</span><span class="n">cache_info</span>
<span class="go">CacheInfo(hits=0, misses=0, maxsize=128, currsize=0)</span>
</pre></div>
</div>
<p>Clearing the cache when it is not needed anymore is advisable since this will help the
Python interpreter to reuse the memory.</p>
</div>
</div>
<div class="section" id="the-deprecated-way-of-loading-simulations">
<h2>The deprecated way of loading simulations<a class="headerlink" href="#the-deprecated-way-of-loading-simulations" title="Permalink to this headline">¶</a></h2>
<p>For the evaluation, two data sets are necessary:</p>
<ol class="arabic simple">
<li>Information about the atoms of the simulation, which is read from gro-files</li>
<li>The trajectory of the simulation, which is read from xtc- or trr-files</li>
</ol>
<p>These two data sets are combined to a coordinates object, that selects only the requested atoms.
This object can also be used to perform coordinate transformations like computing a center of mass.</p>
<div class="section" id="atoms">
<h3>Atoms<a class="headerlink" href="#atoms" title="Permalink to this headline">¶</a></h3>
<p>Atom information is read from gro-files via the function <a class="reference internal" href="mdevaluate.html#mdevaluate.atoms.from_grofile" title="mdevaluate.atoms.from_grofile"><code class="xref py py-func docutils literal"><span class="pre">mdevaluate.atoms.from_grofile()</span></code></a>,
which takes the path to a gro-file as argument and an optional gromacs index file.</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mdevaluate</span> <span class="k">import</span> <span class="n">atoms</span>

<span class="n">all_atoms</span> <span class="o">=</span> <span class="n">atoms</span><span class="o">.</span><span class="n">from_grofile</span><span class="p">(</span><span class="s1">&#39;/data/niels/tutorial/conf.gro&#39;</span><span class="p">,</span>
                               <span class="n">index</span><span class="o">=</span><span class="s1">&#39;/data/niels/tutorial/index.ndx&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For many evaluations, a subset of the system must be selected.
Atoms can be selected by name, residue or direct indices:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">H11_atoms</span> <span class="o">=</span> <span class="n">all_atoms</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">atom_name</span><span class="o">=</span><span class="s1">&#39;H11&#39;</span><span class="p">)</span>
<span class="n">amim_atoms</span> <span class="o">=</span> <span class="n">all_atoms</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">residue_name</span><span class="o">=</span><span class="s1">&#39;AMIM&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Atom subset can be combined with logical operators to obtain the intersection or union of two or more subsets.
The union is equal to a logical or, the intersection is equal to a logical and:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">union</span> <span class="o">=</span> <span class="n">H11_atoms</span> <span class="o">|</span> <span class="n">amim_atoms</span>
<span class="n">intersection</span> <span class="o">=</span> <span class="n">H11_atoms</span> <span class="o">&amp;</span> <span class="n">amim_atoms</span>
</pre></div>
</div>
<p>Excluding atoms from a larger subset can also be done easily with negation:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">exclusion</span> <span class="o">=</span> <span class="n">amim_atoms</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">H11_atoms</span>
</pre></div>
</div>
</div>
<div class="section" id="trajectory">
<h3>Trajectory<a class="headerlink" href="#trajectory" title="Permalink to this headline">¶</a></h3>
<p>The trajectory is read from xtc-files or trr-files, usually the former are used.
For effective data loading, these files have to be indexed <strong>once</strong> before they can be used with mdevaluate.
This is done with the command line tool <code class="docutils literal"><span class="pre">index-xtc</span></code>:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span>$ index-xtc /data/niels/tutorial/traj.xtc
</pre></div>
</div>
<p>The trajectory is than read with an appropiate reader:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mdevaluate.gromacs.reader</span> <span class="k">import</span> <span class="n">XTCReader</span>

<span class="n">trajectory</span> <span class="o">=</span> <span class="n">XTCReader</span><span class="p">(</span><span class="s1">&#39;/data/niels/tutorial/traj.xtc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>From this trajectory, single frames can be selected by index:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">frame</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">box</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">coordinates</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">To this time, even though implemented, the usage of trr-files has not been fully tested.</p>
</div>
</div>
<div class="section" id="coordinates">
<h3>Coordinates<a class="headerlink" href="#coordinates" title="Permalink to this headline">¶</a></h3>
<p>A coordinates object for the evaluation is obtained by combining the trajectory and an atom subset:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mdevaluate</span> <span class="k">import</span> <span class="n">coordinates</span>

<span class="n">cords_amim</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">Coordinates</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">atom_subset</span><span class="o">=</span><span class="n">amim_atoms</span><span class="p">)</span>
</pre></div>
</div>
<p>These coordinates can be transformed if necessary.
The center of mass can be computed with the function <a class="reference internal" href="mdevaluate.html#mdevaluate.coordinates.centers_of_mass" title="mdevaluate.coordinates.centers_of_mass"><code class="xref py py-func docutils literal"><span class="pre">mdevaluate.coordinates.centers_of_mass()</span></code></a>,
which takes coordinates and a list of masses as input.
Only the first set of atom masses has to be given, which will be repeated for the rest of the atoms.
The only requirement is that the length of the list of atoms is an integral multiple of the number of masses given.</p>
<p>To compute a center of mass of the amim molecule:</p>
<div class="highlight-python3"><div class="highlight"><pre><span></span><span class="n">masses</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">15</span> <span class="o">+</span> <span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">*</span><span class="mi">8</span>
<span class="n">com_amim</span> <span class="o">=</span> <span class="n">coordinates</span><span class="o">.</span><span class="n">centers_of_mass</span><span class="p">(</span><span class="n">cords_amim</span><span class="p">,</span> <span class="n">masses</span><span class="o">=</span><span class="n">masses</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the coordinate transformation is not limited to center of masses at all.
Look at the definition of <code class="xref py py-func docutils literal"><span class="pre">centers_of_mass()</span></code> for hints how to implement a different transformation.
On important bit is the decorator <code class="docutils literal"><span class="pre">&#64;coordinates_map</span></code> that is necessary for the transformation to work.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="static-evaluation.html" class="btn btn-neutral float-right" title="Evaluation of static properties" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="guide.html" class="btn btn-neutral" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Niels Müller.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'17.08',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>